<% content_for(:title) { "Edit #{@user.full_name} - Admin - Family Hub" } %>

<div class="max-w-2xl mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex items-center gap-3 mb-6">
    <%= link_to admin_user_path(@user), class: "p-2 -ml-2 text-theme-secondary hover:text-theme-text hover:bg-theme-surface rounded-lg transition-colors" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    <% end %>
    <h1 class="text-2xl font-bold text-theme-text">Edit User</h1>
  </div>

  <!-- User Info Header -->
  <div class="card p-4 mb-6">
    <div class="flex items-center gap-4">
      <% if @user.avatar.attached? %>
        <%= image_tag @user.avatar, class: "w-12 h-12 rounded-full object-cover" %>
      <% else %>
        <div class="w-12 h-12 rounded-full bg-theme-primary/20 flex items-center justify-center">
          <span class="text-theme-primary font-medium"><%= @user.initials %></span>
        </div>
      <% end %>
      <div>
        <p class="font-medium text-theme-text"><%= @user.full_name %></p>
        <p class="text-sm text-theme-secondary"><%= @user.email %></p>
      </div>
    </div>
  </div>

  <!-- Edit Form -->
  <div class="card p-6">
    <%= form_with model: [:admin, @user], class: "space-y-6" do |f| %>
      <% if @user.errors.any? %>
        <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-[15px] p-4">
          <div class="flex items-center gap-2 text-red-800 dark:text-red-200 mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="font-medium">Please fix the following errors:</span>
          </div>
          <ul class="list-disc list-inside text-sm text-red-700 dark:text-red-300">
            <% @user.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= f.label :first_name, class: "label" %>
          <%= f.text_field :first_name, class: "input", required: true %>
        </div>

        <div>
          <%= f.label :last_name, class: "label" %>
          <%= f.text_field :last_name, class: "input", required: true %>
        </div>
      </div>

      <div>
        <%= f.label :email, class: "label" %>
        <%= f.email_field :email, class: "input", required: true %>
      </div>

      <div>
        <%= f.label :city, class: "label" %>
        <%= f.text_field :city, class: "input", required: true %>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= f.label :role, class: "label" %>
          <%= f.select :role,
              [['Member', 'member'], ['Admin', 'admin']],
              {},
              class: "input",
              disabled: @user == current_user %>
          <% if @user == current_user %>
            <p class="text-xs text-theme-secondary mt-1">You cannot change your own role.</p>
          <% end %>
        </div>

        <div>
          <%= f.label :status, class: "label" %>
          <%= f.select :status,
              [['Active', 'active'], ['Inactive', 'inactive'], ['Removed', 'removed']],
              {},
              class: "input",
              disabled: @user == current_user %>
          <% if @user == current_user %>
            <p class="text-xs text-theme-secondary mt-1">You cannot change your own status.</p>
          <% end %>
        </div>
      </div>

      <div class="flex items-center justify-between pt-4 border-t border-theme-border">
        <%= link_to "Cancel", admin_user_path(@user), class: "btn btn-secondary" %>
        <%= f.submit "Save Changes", class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>
